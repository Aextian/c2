import{j as e,K,r as i,a as U,L as W}from"./app-tI2J1YsO.js";import{h as z,i as J,y as L,A as Q}from"./app-layout-B3t13f0S.js";import{C as X,I as Y}from"./InputFile-BiS-BWjO.js";import{f as V,N as Z}from"./NoDataAvailable-LMTA5-5p.js";import{A as $,f as _,g as ee,h as se,i as te,j as ae,T as le,a as ne,b as P,c as B,d as re,e as R,k as ie,l as oe}from"./table-C9NBC-sd.js";import{B as k}from"./badge-BhpZlgco.js";import{B as F}from"./createLucideIcon-DVLgItX8.js";import{L as ce}from"./label-C31aROhU.js";import{S as M,a as O,b as q,c as G,d as de,e as me,f as h,C as he,g as xe}from"./select-BvhsFAjv.js";import{T as ue}from"./textarea-DWYhbVOt.js";import"./index-CaKbJXop.js";import"./index-w0u4n437.js";import"./input-DmEn5zn0.js";import"./index-po8darRK.js";const pe=({cordinator_task:s})=>{var x,o;const a=((o=(x=s==null?void 0:s.sub_task)==null?void 0:x.cordinator_sub_tasks)==null?void 0:o.filter(l=>l.status==="done"))??[];return e.jsxs($,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(k,{className:"text-[10px] hover:cursor-pointer",variant:a.length>0?"default":"outline",children:[a.length," coordinator",a.length!==1?"s have":" has"," completed this task."]})}),e.jsxs(ee,{className:"md:min-w-[600px]",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Coordinators Who Have Completed This Task"}),e.jsx(ae,{children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(P,{children:[e.jsx(B,{className:"w-[100px]",children:"Name"}),e.jsx(B,{children:"Status"}),e.jsx(B,{children:"Completion Date"})]})}),e.jsxs(re,{children:[a.map(l=>{var u;return e.jsxs(P,{children:[e.jsx(R,{className:"font-medium",children:e.jsxs("h1",{className:"first-letter:uppercase",children:[(u=l==null?void 0:l.user)==null?void 0:u.name," "]})}),e.jsx(R,{children:e.jsx(k,{variant:"outline",children:e.jsx("span",{className:"first-letter:uppercase",children:l.status})})}),e.jsx(R,{children:e.jsx(k,{variant:"outline",children:e.jsx("span",{className:"first-letter:uppercase",children:V(l.updated_at)})})})]},l.id)}),a.length===0&&e.jsx(Z,{colSpan:3,title:"No coordinators have completed this task yet."})]})]})})]}),e.jsx(ie,{children:e.jsx(oe,{asChild:!0,children:e.jsx(F,{type:"button",variant:"outline",children:"ok"})})})]})]})},je=({cordinator_task:s,fetchCordinatorTasks:a})=>{var n,d,A,H,E;const{permissions:x}=K().props,[o,l]=i.useState(!1),[u,g]=i.useState(""),[y,I]=i.useState(s.status),[b,N]=i.useState(!1),[v,p]=i.useState(!1),j=i.useRef(null),[c,f]=i.useState({comment:"",file_path:""}),C=async t=>{t.preventDefault(),N(!0);try{const r={subTaskId:s.sub_task_id,comment:c.comment,filePath:c.file_path},m=await U.post(route("users-tasks.comment"),r,{headers:{"Content-Type":"multipart/form-data"}});a(),m.status===200&&(f({comment:"",file_path:""}),g(""),j.current&&(j.current.value="")),N(!1)}catch(r){console.log(r),L.error("Something went wrong"),N(!1)}},w=t=>{const{value:r}=t.target;f({...c,comment:r})},D=async t=>{t.preventDefault(),p(!0);try{const r=route("users-tasks.update-status",{id:s.id}),m=await U.post(r,{status:y});m.status===200&&(L.success(m.data.message),a(),p(!1))}catch(r){console.log(r),p(!1),L.error("Something went wrong")}},S=z(x,J),T=(d=(n=s==null?void 0:s.sub_task)==null?void 0:n.comments)==null?void 0:d.reduce((t,r)=>{var m;return t+1+(((m=r.replies)==null?void 0:m.length)||0)},0);return(H=(A=s==null?void 0:s.sub_task)==null?void 0:A.cordinator_sub_tasks)==null||H.filter(t=>t.status==="done"),e.jsxs("div",{className:"shadow-sidebar-border p-5 shadow-lg",children:[e.jsxs("span",{className:"text-xs",children:["Created:",new Date(s.created_at||"").toDateString()]}),S&&e.jsx("div",{className:"col-span-2 flex justify-end",children:e.jsxs("form",{onSubmit:t=>D(t),className:"flex flex-col items-end justify-end gap-5",children:[e.jsx(ce,{children:"Status"}),e.jsxs(M,{value:y,onValueChange:t=>I(t),children:[e.jsx(O,{className:"] w-[100px]",children:e.jsx(q,{placeholder:"Please Select Status"})}),e.jsx(G,{children:e.jsxs(de,{children:[e.jsx(me,{children:"Status"}),e.jsx(h,{value:"todo",children:"Todo"}),e.jsx(h,{value:"doing",children:"Doing"}),e.jsx(h,{value:"done",children:"Done"})]})})]}),e.jsx(F,{disabled:v||!S,type:"submit",className:"w-[100px]",children:v?"Updating...":"Update"})]})}),e.jsxs("div",{className:"mt-5 mb-10 flex gap-5",children:[e.jsx("h2",{className:"font-bold",children:"Task:"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:s.sub_task.content})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"my-5 flex items-center gap-2 font-bold hover:cursor-pointer",onClick:()=>l(!o),children:[e.jsx("p",{children:"Comments"})," ",T,e.jsx("span",{children:o?e.jsx(he,{}):e.jsx(xe,{})})]}),e.jsx("div",{children:e.jsx(pe,{cordinator_task:s})})]}),o&&e.jsx("ul",{className:"my-5 flex flex-col gap-2 text-xs",children:e.jsx("li",{children:Array.isArray((E=s==null?void 0:s.sub_task)==null?void 0:E.comments)&&s.sub_task.comments.length>0?s.sub_task.comments.map(t=>e.jsx(X,{comment:t,sending:b,fetchCordinatorTasks:a},t.id)):e.jsx("p",{className:"text-gray-500",children:"No comments ."})})}),e.jsxs("form",{onSubmit:t=>C(t),children:[e.jsx(ue,{required:!0,value:c.comment||"",onChange:t=>w(t),placeholder:"write your comment"}),e.jsx("div",{className:"mt-5 flex justify-center md:justify-end",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Y,{setData:f,setFileName:g,fileRef:j,fileName:u}),e.jsx(F,{className:"px-10",disabled:b,children:"Send"})]})})]})]})]})},Le=({id:s})=>{var v,p,j,c,f,C,w,D,S,T;const[a,x]=i.useState([]),[o,l]=i.useState([]),u=[{title:"My Task",href:"/tasks"}],g=(p=(v=a[0])==null?void 0:v.sub_task.task)==null?void 0:p.type,y=(c=(j=a[0])==null?void 0:j.sub_task.task)==null?void 0:c.content,I=(C=(f=a[0])==null?void 0:f.sub_task.task)==null?void 0:C.dead_line,b=async()=>{const d=(await U.get(route("users-tasks.cordinator-tasks",{id:s}))).data;x(d),l(d)};i.useEffect(()=>{b()},[s]);const N=n=>{if(n==="all")l(a);else{const d=a.filter(A=>A.status===n);l(d)}};return e.jsxs(Q,{breadcrumbs:u,children:[e.jsx(W,{title:"tasks"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl md:p-4",children:e.jsxs("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative min-h-[100vh] flex-1 rounded-xl border p-10 md:min-h-min",children:[e.jsxs("div",{className:"mx-auto my-5 flex min-h-64 flex-col gap-5 p-5 shadow-lg md:min-w-96",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("h1",{className:"text-xs md:text-xs",children:[e.jsx("span",{className:"font-bold",children:"Due: "}),V(I)]})}),e.jsxs("h1",{children:[e.jsx("span",{className:"font-bold",children:"Title: "}),(D=(w=a[0])==null?void 0:w.sub_task.task)==null?void 0:D.title]}),e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{children:[e.jsx("span",{children:"Type: "}),e.jsx(k,{variant:g==="important"?"warning":g==="urgent"?"destructive":"default",children:e.jsx("span",{className:"first-letter:uppercase",children:(T=(S=a[0])==null?void 0:S.sub_task.task)==null?void 0:T.type})})]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-bold",children:"Content: "}),e.jsx("p",{className:"text-xs",children:y})]})]})]}),e.jsx("div",{children:e.jsxs(M,{onValueChange:n=>N(n),defaultValue:"all",children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(q,{placeholder:"Filter"})}),e.jsxs(G,{children:[e.jsx(h,{value:"all",children:"All"}),e.jsx(h,{value:"todo",children:"Todo"}),e.jsx(h,{value:"doing",children:"Doing"}),e.jsx(h,{value:"done",children:"Done"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:o.map(n=>e.jsx(je,{fetchCordinatorTasks:b,cordinator_task:n},n.id))})]})})]})};export{Le as default};
