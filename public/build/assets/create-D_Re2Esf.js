import{r as k,u as A,m as O,j as e,L as R}from"./app-tI2J1YsO.js";import{I as u}from"./input-error-Dwl8M-kD.js";import{B as b}from"./createLucideIcon-DVLgItX8.js";import{I as f}from"./input-DmEn5zn0.js";import{L as p}from"./label-C31aROhU.js";import{S as F,a as M,b as V,c as q,d as P,e as z,f as j}from"./select-BvhsFAjv.js";import{T as J}from"./textarea-DWYhbVOt.js";import{A as U}from"./app-layout-B3t13f0S.js";import{S as _}from"./react-select.esm-BWZrrux0.js";import"./index-w0u4n437.js";import"./index-CaKbJXop.js";import"./index-po8darRK.js";const re=({users:v})=>{const y=[{title:"Tasks",href:"/tasks"}],m=k.useRef(null),[h,x]=k.useState(!1),{appearance:C}=A(),n=C==="dark",{post:T,setData:c,data:o,errors:d,processing:E,clearErrors:N,reset:L}=O({title:"",content:"",deadLine:"",type:"",options:[]}),g=t=>{const{name:a,value:s}=t.target;c(r=>({...r,[a]:s}))},w=(t,a)=>{const{name:s,value:r}=t.target;c(l=>{const i=[...l.options];return i[a]={...i[a],[s]:r},{...l,options:i}})},I=t=>{c(a=>({...a,options:a.options.filter((s,r)=>r!==t)}))},B=t=>{t.preventDefault();const a=route("tasks.store");T(a,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{L(),N()},onError:s=>{console.log(s)}})},D=async()=>{var t;x(!0);try{const s=await(await fetch("/openai/generate-subtasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:o.title})})).json();x(!1);const r=s.choices[0].message.content.split(`
`).filter(l=>/^\d+\.\s*/.test(l)).map(l=>l.replace(/^\d+\.\s*/,"").replace(/\*\*/g,"").trim());m.current&&((t=m.current)==null||t.clearValue()),c(l=>({...l,options:r.map(i=>({subTask:i,userIds:[]}))}))}catch(a){x(!1),console.error("Error generating sub-tasks:",a)}},S=v.map(t=>({value:t.id,label:t.name}));return e.jsxs(U,{breadcrumbs:y,children:[e.jsx(R,{title:"tasks"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative min-h-[100vh] flex-1 rounded-xl border p-10 md:min-h-min",children:e.jsxs("form",{onSubmit:B,className:"grid grid-cols-1 gap-5",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col gap-5 border-r p-5",children:[e.jsxs("div",{className:"flex max-h-fit flex-1 flex-col gap-5 self-end",children:[e.jsx(p,{children:"Due Date"}),e.jsx(f,{onChange:g,value:o.deadLine,type:"datetime-local",name:"deadLine"}),e.jsx(u,{message:d.deadLine})]}),e.jsx(p,{children:"Title"}),e.jsx(f,{onChange:g,value:o.title,type:"text",name:"title"}),e.jsx(u,{message:d.title}),e.jsx(p,{children:"Type"}),e.jsxs(F,{onValueChange:t=>c({...o,type:t}),children:[e.jsx(M,{children:e.jsx(V,{placeholder:"Select a type"})}),e.jsx(q,{children:e.jsxs(P,{children:[e.jsx(z,{children:"Type"}),e.jsx(j,{value:"minor",children:"Minor"}),e.jsx(j,{value:"important",children:"Important"}),e.jsx(j,{value:"urgent",children:"Urgent"})]})})]}),e.jsx(u,{message:d.type}),e.jsx(p,{children:"Content"}),e.jsx(J,{onChange:g,value:o.content,name:"content",required:!0,rows:4,placeholder:"Type your message here."}),e.jsx(u,{message:d.content}),e.jsx(b,{type:"button",disabled:h||!o.title,onClick:D,children:h?"Generating...":"Generate Subtasks"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:o.options.map((t,a)=>e.jsxs("div",{className:"flex flex-col gap-5 border p-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h1",{className:"font-bold",children:["Subtask ",a+1]}),e.jsx(b,{type:"button",variant:"destructive",size:"sm",onClick:()=>I(a),children:"Delete"})]}),e.jsx(f,{value:t.subTask,onChange:s=>w(s,a),type:"text",name:"subTask"}),e.jsx(_,{ref:m,className:"basic-single",classNamePrefix:"select",isLoading:!1,isClearable:!0,isSearchable:!0,value:S.filter(s=>t==null?void 0:t.userIds.includes(s.value)),isMulti:!0,required:!0,onChange:s=>c(r=>({...r,options:r.options.map((l,i)=>i===a?{...l,userIds:s.map(G=>G.value)}:l)})),styles:{control:(s,r)=>({...s,backgroundColor:n?"#1E293B":"white",borderColor:r.isFocused?n?"#475569":"#CBD5E1":n?"#334155":"#E2E8F0",color:n?"white":"black"}),menu:s=>({...s,backgroundColor:n?"#1E293B":"white",color:n?"white":"black"}),option:(s,{isFocused:r,isSelected:l})=>({...s,backgroundColor:l?n?"#334155":"#E2E8F0":r?n?"#475569":"#CBD5E1":"transparent",color:n?"white":"black"}),singleValue:s=>({...s,color:n?"white":"black"})},options:S,placeholder:"Select Employee"})]},a))})]}),o.options&&o.options.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{disabled:h||E,type:"submit",children:"Submit"})})]})})})]})};export{re as default};
