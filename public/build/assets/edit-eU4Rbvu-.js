import{r as E,u as G,m as M,j as e,L as U}from"./app-tI2J1YsO.js";import{I as h}from"./input-error-Dwl8M-kD.js";import{B as j}from"./createLucideIcon-DVLgItX8.js";import{I as v}from"./input-DmEn5zn0.js";import{L as g}from"./label-C31aROhU.js";import{S as P,a as V,b as q,c as z,d as J,e as $,f as y}from"./select-BvhsFAjv.js";import{T as H}from"./textarea-DWYhbVOt.js";import{A as K,y as Q}from"./app-layout-B3t13f0S.js";import{S as W}from"./react-select.esm-BWZrrux0.js";import"./index-w0u4n437.js";import"./index-CaKbJXop.js";import"./index-po8darRK.js";const ce=({users:T,task:c})=>{var C;const N=[{title:"Tasks",href:"/tasks"}],L=E.useRef(null),[x,b]=E.useState(!1),{appearance:w}=G(),i=w==="dark",{put:I,setData:d,data:l,errors:p,processing:S,clearErrors:B,reset:R}=M({title:c.title,content:c.content,deadLine:c.dead_line??"",type:c.type,options:((C=c.sub_tasks)==null?void 0:C.map(t=>{var s;return{id:t.id,subTask:t.content,userIds:((s=t.cordinator_sub_tasks)==null?void 0:s.map(r=>r.user_id).filter(r=>r!==void 0))??[]}}))??[]});console.log(l);const f=t=>{const{name:s,value:r}=t.target;d(o=>({...o,[s]:r}))},_=(t,s)=>{const{name:r,value:o}=t.target;d(a=>{const n=[...a.options];return n[s]={...n[s],[r]:o},{...a,options:n}})},D=t=>{d(s=>({...s,options:s.options.filter((r,o)=>o!==t)}))},A=t=>{t.preventDefault();const s=route("tasks.update",c.id);I(s,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{R(),B()},onError:r=>{console.log(r)}})},O=async()=>{b(!0);try{const s=await(await fetch("/openai/generate-subtasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:l.title})})).json();b(!1);const r=s.choices[0].message.content.split(`
`).filter(o=>/^\d+\.\s*/.test(o)).map(o=>o.replace(/^\d+\.\s*/,"").replace(/\*\*/g,"").trim());d(o=>({...o,options:r.map((a,n)=>({...o.options[n],subTask:a}))})),Q.success("Sub-tasks generated successfully")}catch(t){b(!1),console.error("Error generating sub-tasks:",t)}},k=T.map(t=>({value:t.id,label:t.name}));return e.jsxs(K,{breadcrumbs:N,children:[e.jsx(U,{title:"tasks"}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative min-h-[100vh] flex-1 rounded-xl border p-10 md:min-h-min",children:e.jsxs("form",{onSubmit:A,className:"grid grid-cols-1 gap-5",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col gap-5 border-r p-5",children:[e.jsxs("div",{className:"flex max-h-fit flex-1 flex-col gap-5 self-end",children:[e.jsx(g,{children:"Due Date"}),e.jsx(v,{onChange:f,value:l.deadLine,type:"datetime-local",name:"deadLine"}),e.jsx(h,{message:p.deadLine})]}),e.jsx(g,{children:"Title"}),e.jsx(v,{onChange:f,value:l.title,type:"text",name:"title"}),e.jsx(h,{message:p.title}),e.jsx(g,{children:"Type"}),e.jsxs(P,{value:l.type,onValueChange:t=>d({...l,type:t}),children:[e.jsx(V,{children:e.jsx(q,{placeholder:"Select a type"})}),e.jsx(z,{children:e.jsxs(J,{children:[e.jsx($,{children:"Type"}),e.jsx(y,{value:"minor",children:"Minor"}),e.jsx(y,{value:"important",children:"Important"}),e.jsx(y,{value:"urgent",children:"Urgent"})]})})]}),e.jsx(h,{message:p.type}),e.jsx(g,{children:"Content"}),e.jsx(H,{onChange:f,value:l.content,name:"content",rows:4,placeholder:"Type your message here."}),e.jsx(h,{message:p.content}),e.jsx(j,{type:"button",disabled:x||!l.title,onClick:O,children:x?"Regenerating...":"Regenerate Subtasks"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:l.options.map((t,s)=>{var r,o;return e.jsxs("div",{className:"flex flex-col gap-5 border p-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h1",{className:"font-bold",children:["Subtask ",s+1]}),e.jsx(j,{type:"button",variant:"destructive",size:"sm",onClick:()=>D(s),children:"Delete"})]}),e.jsx(v,{value:t.subTask,onChange:a=>_(a,s),type:"text",name:"subTask"}),e.jsx(W,{ref:L,className:"basic-single",classNamePrefix:"select",isLoading:!1,isClearable:!0,isSearchable:!0,isMulti:!0,required:!0,value:((r=l.options[s])==null?void 0:r.userIds)&&((o=l.options[s])==null?void 0:o.userIds.map(a=>k.find(n=>n.value===a))),onChange:a=>d(n=>({...n,options:n.options.map((u,F)=>F===s?{...u,userIds:a.map(m=>m&&m.value).filter(m=>m!==void 0)}:u)})),styles:{control:(a,n)=>({...a,backgroundColor:i?"#1E293B":"white",borderColor:n.isFocused?i?"#475569":"#CBD5E1":i?"#334155":"#E2E8F0",color:i?"white":"black"}),menu:a=>({...a,backgroundColor:i?"#1E293B":"white",color:i?"white":"black"}),option:(a,{isFocused:n,isSelected:u})=>({...a,backgroundColor:u?i?"#334155":"#E2E8F0":n?i?"#475569":"#CBD5E1":"transparent",color:i?"white":"black"}),singleValue:a=>({...a,color:i?"white":"black"})},options:k,placeholder:"Select Employee"})]},s)})})]}),l.options&&l.options.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{disabled:x||S,type:"submit",children:S?"Updating...":"Update"})})]})})})]})};export{ce as default};
